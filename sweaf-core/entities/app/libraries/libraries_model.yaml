entities:  
  sweaf.app.libraries:
    title: –ú–æ–¥–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏
    description: >
      –ü—Ä–∏ –ø–æ–º–æ—â–∏ –¥–∞–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    schema:
      type: object
      patternProperties:        
        "^[a-zA-Z][a-zA-Z0-9_-]*(\\.[a-zA-Z0-9][a-zA-Z0-9_-]*)*$":
          type: object
          properties:
            title:
              title: –ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
              type: string
            description:
              title: –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫
              type: string
            library_type:
              title: –ú–æ–¥–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
              enum:
                - inhouse
                - external
            control_type:
              title: –†–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
              enum:
                - regulated
                - external
            mentor:
              title: –õ–æ–≥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–µ–≥–æ –≤–µ–∫—Ç–æ—Ä —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –ø–æ–ø—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
              type: string
            maintainers:
              title: –õ–æ–≥–∏–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –≤–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–æ–≤—É—é –±–∞–∑—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
              type: array
              items:
                type: string
            repository:
              title: –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
              type: string
            technologies:
              title: –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
              type: array
              items:
                type: string
          required:
            - title
            - description
            - library_type
            - control_type
            - mentor
            - repository
    objects:
      library:
        route: "/"
        title: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
        symbol: "do"


    menu: >
      (
        [
          {
            "location": "–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞/–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏/–ö–∞—Ç–∞–ª–æ–≥ –±–∏–±–ª–∏–æ—Ç–µ–∫",
            "link": "entities/sweaf.app.libraries/libraries_list"
          },
          {            
            "link": "entities/sweaf.app.libraries/libraries_in_systems",
            "location": "–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞/–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏/–°–ø–∏—Å–æ–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö"
          }
        ]
      )

    presentations: 
      libraries_list:
        type: markdown
        title: –ö–∞—Ç–∞–ª–æ–≥ –±–∏–±–ª–∏–æ—Ç–µ–∫
        template: templates/libraries_table.md

      libraries_table_list:
        type: table
        title: –¢–∞–±–ª–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫
        headers:
          - value: title
            text: –ù–∞–∑–≤–∞–Ω–∏–µ
            sortable: true
            align: left
            width: 10%
            link: link_to_library_entity
          - value: description
            text: –û–ø–∏—Å–∞–Ω–∏–µ
            sortable: true
            align: left
          - value: library_type
            text: –¢–∏–ø –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
            sortable: true
            align: left
          - value: control_type
            text: –¢–∏–ø —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            sortable: true
            align: left
          - value: support_link
            text: –ü–æ–¥–¥–µ—Ä–∂–∫–∞
            link: support
            sortable: true
            align: left 
          - value: repository_link
            text: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
            link: repository
            sortable: true
            align: left 
          - value: registry_link
            text: –†–µ–µ—Å—Ç—Ä
            link: registry
            sortable: true
            align: left 
          - value: mentor
            text: –ú–µ–Ω—Ç–æ—Ä
            sortable: true
            align: left
          - value: maintainers
            text: –°–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—â–∏–µ
            align: left
        source: sweaf.app.dataset.libraries_table_list
      
      library_card:
        type: markdown
        title: –ö–∞—Ä—Ç–æ—á–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        params:
          type: object
          properties:
            id:
              type: string
          required:
            - library_id
        template: templates/library_card.md
        source: >
          (
            $libraries := [$."sweaf.app.libraries".$spread().$merge([$.*, {"library_id": $keys($)}])];
            $libraries [library_id=$params.library_id];
          )

      # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, –≤—Å–µ —ç—Ç–æ –≤—ã–≤–æ–¥–∏–º –≤ —Ç–∞–±–ª–∏—Ü—É
      libraries_table_in_systems:
        type: table
        title: –¢–∞–±–ª–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–∞—Ö
        headers:
          - value: system_title
            text: –°–∏—Å—Ç–µ–º–∞
            sortable: true
            align: left
            link: link_to_system

          - value: system_libraries
            text: –§–∏–ª—å—Ç—Ä
            link: link_to_system_libraries
            align: left            

          - value: title
            text: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
            sortable: true
            align: left
            link: link_to_library

          - value: library_id
            text: ID –≤ DocHub
            sortable: true
            align: left
        source: sweaf.app.dataset.libraries_table_in_systems
          

      # –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –≤ –∑–∞–ø—Ä–æ—Å–µ –≤—ã—à–µ libraries_table_in_systems
      libraries_in_systems:
        type: markdown
        title: –¢–∞–±–ª–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –≤ md
        template: templates/libraries_in_systems.md

      # –ù–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç —Ç–∞–±–ª–∏—Ü—ã libraries_table_in_systems –∏ –¥–µ–ª–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
      libraries_table_in_systems.filtered: # –î–æ—á–µ—Ä–Ω—è—è —Ç–∞–±–ª–∏—Ü–∞
        type: table
        title: –¢–∞–±–ª–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–∞—Ö —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
        params:
          type: object
          properties:
            system_id:
              type: string
          required:
            - system_id
        headers:
          - value: system_title
            text: –°–∏—Å—Ç–µ–º–∞
            sortable: true
            align: left
            link: link_to_system

          - value: title
            text: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
            sortable: true
            align: left
            link: link_to_library

          - value: library_id
            text: ID –≤ DocHub
            sortable: true
            align: left
        origin: sweaf.app.dataset.libraries_table_in_systems # –ë–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
        source: >
          (
              [$[system_id=$params.system_id]]
          )

      systems_library_used.filtered: # –î–æ—á–µ—Ä–Ω—è—è —Ç–∞–±–ª–∏—Ü–∞
        type: table
        title: –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        params:
          type: object
          properties:
            library_id:
              type: string
          required:
            - library_id
        headers:
          - value: system_title
            text: –°–∏—Å—Ç–µ–º–∞
            sortable: true
            align: left
            link: link_to_system

          - value: system_id
            text: ID —Å–∏—Å—Ç–µ–º—ã –≤ DocHub
            sortable: true
            align: left
        origin: sweaf.app.dataset.libraries_table_in_systems # –ë–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
        source: >
          (
              [$[library_id=$params.library_id]]
          )

datasets:
  sweaf.app.dataset.libraries_table_list:
    source: >
      (
        $manifest := $;
        $dictionaries := $manifest."sweaf.ia.dictionaries";
        $accounts := $dictionaries."accounts".parameters;
        $manifest."sweaf.app.libraries".$spread().($merge([{"library_id" : $keys()[0]}, $.*])).(
          {
            "library_id": library_id,
            "link_to_library_entity": "/entities/sweaf.app.libraries/library_card?library_id=" & library_id,
            "title": title,
            "description": description,
            "library_type": library_type,
            "control_type": control_type,
            "support": support,
            "support_link": support ? "üë®‚Äçüîß" : "",
            "mentor": $get_account(mentor, $accounts).title,
            "maintainers": $.maintainers.([$get_account($, $accounts).title]),
            "repository": repository,
            "repository_link": repository ? "üîó" : "",
            "registry": registry,
            "registry_link": registry ? "üîó" : ""
          }
        );
      )

  sweaf.app.dataset.libraries_table_in_systems:
    source: >
      (
        $manifest := $;
        $manifest.components.$spread().(
          $system_id := $keys()[0];
          $system := $;
          $system_title := $.*.title;
          $distinct($system.*.libraries.(
            $library_id := $string($);
            $library := $lookup($manifest."sweaf.app.libraries", $library_id);
            $type($library.title)="string"
            ? (
              $libraries := $merge([$library, {"id": $library_id}]);
              {
                "library_id": $library_id,                /* ID –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ –≤ DocHub */
                "title": $library.title,
                "link_to_library": "/entities/sweaf.app.libraries/library_card?library_id=" & $library_id,
                "system_id": $system_id,
                "link_to_system": "/architect/components/" & $system_id,
                "system_title": $system_title,
                "system_libraries": "–û—Ç–±–æ—Ä –ø–æ —Å–∏—Å—Ç–µ–º–µ",
                "link_to_system_libraries": "/entities/sweaf.app.libraries/libraries_table_in_systems.filtered?system_id=" & $system_id
              }
              )
          ));
        )^(system_id)
      )
